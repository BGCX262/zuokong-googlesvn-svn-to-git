/*! \file  task_uarttocan.c
* \b 接口说明：
*       
*
* \b 功能描述:
*
*       串口转CAN任务
*
* \b 历史记录:
*
*     <作者>        <时间>      <修改记录> <br>
*     zuokongxiao  2013-03-14   创建文件   <br>
*/

/******************************************************************************/
/*                             头文件                                         */
/******************************************************************************/
#include "ucos_ii.h"
#include "os_cpu.h"
#include "deftype.h"
#include "task_app.h"
#include "bsp.h"
#include "led.h"
#include "uart.h"
#include "debug.h"
#include "can.h"
#include "protocol.h"


/******************************************************************************/
/*                             宏定义                                         */
/******************************************************************************/

/******************************************************************************/
/*                            变量定义                                        */
/******************************************************************************/

/******************************************************************************/
/*                          内部接口声明                                      */
/******************************************************************************/


/******************************************************************************/
/*                          内部接口实现                                      */
/******************************************************************************/


/******************************************************************************/
/*                          外部接口实现                                      */
/******************************************************************************/
/*! \fn       void app_task_uarttocan(void *pdata)
*
*  \brief     串口转换CAN任务
*
*  \param     无
*
*  \exception 无
*
*  \return    无
*/
void app_task_uarttocan(void *pdata)
{
    /* 防止编译器告警 */
    pdata = pdata;
    /*! 初始化CAN */
    can_init();
    
    /*! 任务循环 */
    for( ; ; )
    {
        /*! 通信协议 */
        if(EXIT_FAILURE == protocol_process())
        {
            debug_msg("E:Protocol process error!", __FILE__, __LINE__);
        }
        else
        {
            /* 任务延时 */
            OSTimeDlyHMSM(0, 0, 0, 1);
        }

        print_can_frame();
    }
}

/********************************end of file***********************************/

